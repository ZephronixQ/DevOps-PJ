# Контроль доступа и RBAC (Role-Based Access Control)

RBAC (Role-Based Access Control) в Kubernetes позволяет управлять доступом к ресурсам кластера, определяя, какие действия пользователи и группы могут выполнять на различных ресурсах. Это достигается с помощью ролей, привязок ролей и кластерных ролей.

## Основные компоненты RBAC

1. **Роли (Roles) и Кластерные Роли (ClusterRoles)**

   - **Role**: Определяет права доступа к ресурсам в пределах одного пространства имен.
   - **ClusterRole**: Определяет права доступа к ресурсам на уровне всего кластера.

   Пример **ClusterRole**:

   ```yaml
   apiVersion: rbac.authorization.k8s.io/v1
   kind: ClusterRole
   metadata:
     name: my-cluster-role
   rules:
   - apiGroups: [""]
     resources: ["secrets"]
     verbs: ["get", "watch", "list"]
   ```

   - **apiGroups**: Группы API, к которым применяются правила.
   - **resources**: Типы ресурсов, к которым применяются правила (например, `secrets`).
   - **verbs**: Действия, которые разрешены (например, `get`, `watch`, `list`).

2. **Привязки Ролей (RoleBindings) и Кластерных Привязок Ролей (ClusterRoleBindings)**

   - **RoleBinding**: Привязывает роль (Role) к пользователю или группе в пределах одного пространства имен.
   - **ClusterRoleBinding**: Привязывает кластерную роль (ClusterRole) к пользователю или группе на уровне всего кластера.

   Пример **RoleBinding**:

   ```yaml
   apiVersion: rbac.authorization.k8s.io/v1
   kind: RoleBinding
   metadata:
     name: daisy-edit
     namespace: demo
   subjects:
   - kind: User
     name: daisy
     apiGroup: rbac.authorization.k8s.io
   roleRef:
     kind: ClusterRole
     name: edit
     apiGroup: rbac.authorization.k8s.io
   ```

   - **subjects**: Указывает пользователей, групп или сервисные аккаунты, которым предоставляются права.
   - **roleRef**: Указывает роль или кластерную роль, которая привязывается.

## Команды для проверки и управления RBAC

- **Просмотр деталей о привязках ролей и кластерных ролях**:

  ```sh
  kubectl describe clusterrole/edit
  ```

  Эта команда показывает информацию о кластерной роли `edit`, включая ее правила и привилегии.

- **Получение информации о компонентах API сервера**:

  ```sh
  kubectl describe pod -n kube-system -l component=kube-apiserver
  ```

  Команда выводит информацию о поде API сервера, что может быть полезно для диагностики и проверки состояния кластера.

## Когда использовать RBAC

- **Управление доступом**: Для контроля прав пользователей и групп в кластере.
- **Безопасность**: Для обеспечения минимальных привилегий и защиты ресурсов кластера.
- **Изоляция**: Для разграничения доступа к ресурсам в разных пространствах имен или уровнях кластера.

## Почему важно

RBAC помогает обеспечить безопасность и соответствие требованиям путем детального контроля доступа к ресурсам, предотвращая несанкционированное использование и обеспечивая гибкое управление привилегиями.

Использование RBAC помогает в управлении доступом и повышает безопасность кластера Kubernetes, позволяя точно настроить права и ограничения для пользователей и сервисов.
